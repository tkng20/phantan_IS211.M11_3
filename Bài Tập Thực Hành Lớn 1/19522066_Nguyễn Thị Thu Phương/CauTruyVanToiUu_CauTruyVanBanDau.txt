--Câu truy vấn ban đầu
SELECT KH.MAKH, KH.TENKH
FROM HOADON HD , PHIEUDICHVU PDV, CT_PHIEUDICHVU CTPDV, DICHVU DV, KHACHHANG KH, CHINHANH CN
WHERE HD.MAPDV = PDV.MAPDV AND EXTRACT(MONTH FROM HD.NGAYTT) = 7 AND PDV.TIENDV > 10000000
AND CTPDV.MAPDV = PDV.MAPDV AND DV.MADV = CTPDV.MADV AND TENDV = 'Casino' AND KH.MAKH = HD.MAKH
AND TENCN = 'CN Huế' AND CN.MACN = KH.MACN AND QUOCTICH = 'Việt Nam';


--Câu truy vấn tối ưu hóa
SELECT MAKH, TENKH 
FROM (  SELECT C.MAPDV 
        FROM (  SELECT MAPDV 
                FROM (SELECT MAPDV, MADV FROM CT_PHIEUDICHVU)A  JOIN 
                    (SELECT MADV FROM DICHVU WHERE TENDV = 'Casino')B 
                        ON A.MADV = B.MADV)C 
            JOIN 
            (   SELECT MAPDV FROM PHIEUDICHVU WHERE TIENDV > 10000000)D 
            ON C.MAPDV = D.MAPDV)E 
        JOIN 
    (   SELECT MAKH, TENKH, MAPDV 
        FROM (SELECT MACN FROM CHINHANH WHERE TENCN = 'CN Huế')I 
                    JOIN 
             ( SELECT G.MAKH, TENKH, MAPDV, MACN 
               FROM (SELECT MAKH, TENKH, MACN FROM KHACHHANG)F 
                            JOIN 
                    (SELECT MAKH, MAPDV FROM HOADON WHERE EXTRACT(MONTH FROM NGAYTT)= 7 )G 
                            ON F.MAKH = G.MAKH)H
                   ON I.MACN = H.MACN)J 
        ON E.MAPDV = J.MAPDV
